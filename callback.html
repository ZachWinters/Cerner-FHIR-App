<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Cerner SMART on FHIR Redirect</title>
</head>
<body>
  <h2>Cerner OAuth2 Redirect Handler</h2>
  <p id="status">Waiting for redirectâ€¦</p>
  <pre id="output"></pre>

  <script>
    // Parse query parameters
    const params = new URLSearchParams(window.location.search);
    const status = document.getElementById("status");
    const output = document.getElementById("output");

    if (params.has("error")) {
      status.innerText = "Error: " + params.get("error_description") || params.get("error");
    } else if (params.has("code")) {
      const code = params.get("code");
      const state = params.get("state");

      status.innerText = "Authorization code received!";
      
      // Update with your sandbox details:
      const tenant_id   = "bb33c795-2eb8-435c-8801-ce1c00588ccf";
      const client_id   = "62ceaaa1-aba7-468f-a246-87f614f9550b";
      const redirect_uri = "https://your-username.github.io/cerner-fhir-redirect/callback.html";

      const token_url = `https://authorization.sandboxcerner.com/tenants/${tenant_id}/protocols/oauth2/profiles/smart/token`;

      const curl = `
curl -X POST "${token_url}" \\
  -H "Content-Type: application/x-www-form-urlencoded" \\
  -d "grant_type=authorization_code" \\
  -d "code=${code}" \\
  -d "redirect_uri=${redirect_uri}" \\
  -d "client_id=${client_id}"
`;

      output.innerText = "Copy and run this curl command to get your access_token:\n\n" + curl;
    } else {
      status.innerText = "No code or error found in redirect.";
    }
  </script>
</body>
</html>
